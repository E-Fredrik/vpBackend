generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum Gender {
  MALE
  FEMALE
  UNDISCLOSED
}

enum HealthCondition {
  HEART_CONDITION
  RESPIRATORY_ISSUES
  DIABETES
  HYPERTENSION
}

enum FriendStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}

enum PlaceCategory {
  RESTAURANT
  PARK
  GYM
  STORE
  OTHER
}
model User {
  user_id      Int                @id @default(autoincrement())
  username     String             @unique
  password     String
  name         String?
  bmiGoal      Float?
  height       Int?
  healthCondition HealthCondition?
  weight       Float?
  email        String           @unique
  birthDate    DateTime?
  gender       Gender?
  requestedFriends  Friend[]       @relation("RequesterFriends")
  addresseeFriends  Friend[]       @relation("AddresseeFriends")
  dailySummaries    Daily_Summary[]
  foodLogs          Food_Log[]
  activityRecords   Activity_Log[]
  visitRecords      Visit_Log[]
  emaLogs           EMA_Log[]

  @@map("users")
}

model Friend {
  friend_id     Int          @id @default(autoincrement())
  requester_id  Int
  addressee_id  Int
  status        FriendStatus @default(PENDING)
  createdAt     DateTime     @default(now())

  requester User @relation("RequesterFriends", fields: [requester_id], references: [user_id], onDelete: Cascade)
  addressee User @relation("AddresseeFriends", fields: [addressee_id], references: [user_id], onDelete: Cascade)

  @@unique([requester_id, addressee_id]) // prevent duplicates
  @@index([requester_id])
  @@index([addressee_id])

  @@map("friends")
}

model Daily_Summary {
  summary_id       Int      @id @default(autoincrement())
  user_id          Int
  date             DateTime
  totalCaloriesIn  Int

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("daily_summary")
}

model Place_of_Interest {
  place_id       Int     @id @default(autoincrement())
  name           String
  category       PlaceCategory
  latitude       Float
  longitude      Float
  geofenceRadius Int

  visitRecords Visit_Log[]

  @@index([category])
  @@index([latitude, longitude])
  @@map("place_of_interest")
}

model Food {
  food_id   Int    @id @default(autoincrement())
  name      String
  calories  Int

  foodInLogs FoodInLog[]

  @@map("food")
}

model Food_Log {
  log_id    Int     @id @default(autoincrement())
  user_id   Int
  timestamp BigInt
  latitude  Float?
  longitude Float?

  user       User        @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  foodInLogs FoodInLog[]

  @@index([user_id])
  @@index([timestamp])
  @@index([user_id, timestamp])
  @@index([latitude, longitude])
  @@map("food_log")
}

model FoodInLog {
  id       Int @id @default(autoincrement())
  log_id   Int
  food_id  Int
  quantity Int?
  calories Int?

  log  Food_Log @relation(fields: [log_id], references: [log_id], onDelete: Cascade)
  food Food     @relation(fields: [food_id], references: [food_id], onDelete: Cascade)

  @@map("food_log_items")
}

model Activity_Log {
  activity_id  Int    @id @default(autoincrement())
  user_id      Int
  activityType String
  startTime    BigInt
  endTime      BigInt
  confidence   Int

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@index([activityType])
  @@index([startTime])
  @@index([user_id, startTime])
  @@map("activity_log")
}

model Visit_Log {
  visit_id     Int    @id @default(autoincrement())
  user_id      Int
  place_id     Int
  entryTime    BigInt
  exitTime     BigInt
  durationMins Int

  user  User              @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  place Place_of_Interest @relation(fields: [place_id], references: [place_id], onDelete: Cascade)

  @@index([user_id])
  @@index([place_id])
  @@index([entryTime])
  @@index([user_id, entryTime])
  @@map("visit_log")
}

model EMA_Log {
  ema_id        Int    @id @default(autoincrement())
  user_id       Int
  moodScore     Int
  context       String?
  timestamp     BigInt
  latitude      Float?
  longitude     Float?
  geofenceRadius Int?

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@index([timestamp])
  @@index([user_id, timestamp])
  @@index([latitude, longitude])
  @@map("ema_log")
}